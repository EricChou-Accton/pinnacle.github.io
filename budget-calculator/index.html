<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>每月預算計算器</title>
    <!-- 引入Bootstrap CSS框架 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* 滑動條容器樣式 */
        .range-container {
            display: flex;
            align-items: center;
        }
        /* 數值文字樣式 */
        .value-text {
            margin-left: 10px;
        }
        /* 開銷列樣式 */
        .expense-row {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
<!-- 主要計算器容器 -->
<div id="budgetCalculator" class="container">
    <h1 class="text-center mb-4">每月預算計算器</h1>

    <!-- 年月選擇區域 -->
    <div class="row mb-3">
        <div class="col-12 col-md-6">
            <label for="yearSelect">年份:</label>
            <select id="yearSelect" class="form-control">
                <script>
                    // 動態生成年份選項，前後各5年
                    const currentYear = new Date().getFullYear();
                    for (let i = currentYear - 5; i <= currentYear + 5; i++) {
                        document.write(`<option ${i === currentYear ? 'selected' : ''}>${i}</option>`);
                    }
                </script>
            </select>
        </div>
        <div class="col-12 col-md-6">
            <label for="monthSelect">月份:</label>
            <select id="monthSelect" class="form-control">
                <script>
                    // 動態生成月份選項
                    for (let i = 1; i <= 12; i++) {
                        document.write(`<option ${new Date().getMonth() + 1 === i ? 'selected' : ''}>${i}</option>`);
                    }
                </script>
            </select>
        </div>
    </div>

    <!-- 收入輸入區域 -->
    <div class="row mb-3">
        <div class="col-12 col-md-6">
            <label for="monthlyIncomeRange">每月收入(萬):</label>
            <div class="range-container">
                <input type="range" id="monthlyIncomeRange" class="form-range" min="1" max="10" step="0.1" value="5">
                <span id="monthlyIncomeValue" class="value-text">5</span>
                <span class="value-text">萬</span>
            </div>
        </div>
    </div>

    <!-- 開銷輸入區域 -->
    <div id="expensesContainer">
        <div class="expense-row row mb-3">
            <div class="col-12 col-md-6">
                <label for="expenseName1">開銷名稱:</label>
                <input type="text" id="expenseName1" class="form-control expense-name" placeholder="例如：房租、伙食費">
            </div>
            <div class="col-12 col-md-6">
                <label for="expenseRange1">開銷金額(萬):</label>
                <div class="range-container">
                    <input type="range" id="expenseRange1" class="form-range expense-range" min="0" max="5" step="0.1" value="1">
                    <span id="expenseValue1" class="expense-amount-value value-text">1</span>
                    <span class="value-text">萬</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 操作按鈕區域 -->
    <div class="row mt-3">
        <div class="col-12">
            <button id="addExpenseBtn" class="btn btn-secondary me-2">+ 新增開銷</button>
            <button id="calculateBudgetBtn" class="btn btn-primary me-2">計算預算</button>
            <button id="exportPdfBtn" class="btn btn-success">匯出PDF</button>
        </div>
    </div>

    <!-- 結果顯示區域 -->
    <div id="resultArea" class="mt-4 d-none">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">預算明細</h5>
                <p>預算年月: <span id="budgetPeriodDisplay"></span></p>
                <p>每月總收入: <span id="totalIncomeDisplay"></span></p>
                <p>總開銷: <span id="totalExpensesDisplay"></span></p>
                <p>剩餘金額: <span id="remainingAmountDisplay"></span></p>
                <table class="table">
                    <thead>
                        <tr>
                            <th>開銷名稱</th>
                            <th>金額</th>
                        </tr>
                    </thead>
                    <tbody id="expenseDetailsBody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
// 當DOM加載完成後執行
document.addEventListener('DOMContentLoaded', () => {
    // 獲取主要DOM元素
    const monthlyIncomeRange = document.getElementById('monthlyIncomeRange');
    const monthlyIncomeValue = document.getElementById('monthlyIncomeValue');
    const expensesContainer = document.getElementById('expensesContainer');
    const addExpenseBtn = document.getElementById('addExpenseBtn');
    const calculateBudgetBtn = document.getElementById('calculateBudgetBtn');
    const resultArea = document.getElementById('resultArea');
    let expenseCounter = 1;

    // 更新收入顯示並動態調整開銷上限
    monthlyIncomeRange.addEventListener('input', () => {
        monthlyIncomeValue.textContent = monthlyIncomeRange.value;
        
        // 動態更新所有開銷範圍的最大值
        const expenseRanges = document.querySelectorAll('.expense-range');
        expenseRanges.forEach(range => {
            range.max = monthlyIncomeRange.value;
            // 如果當前值超過新的最大值，則調整為最大值
            if (parseFloat(range.value) > parseFloat(range.max)) {
                range.value = range.max;
                const valueSpan = range.nextElementSibling;
                valueSpan.textContent = range.value;
            }
        });
    });

    // 設置開銷範圍監聽器的函數
    function setupExpenseRangeListeners(expenseRange) {
        const expenseValue = expenseRange.nextElementSibling;
        expenseRange.addEventListener('input', () => {
            expenseValue.textContent = expenseRange.value;
        });
    }

    // 初始化第一個開銷範圍
    const firstExpenseRange = document.getElementById('expenseRange1');
    firstExpenseRange.max = monthlyIncomeRange.value;
    setupExpenseRangeListeners(firstExpenseRange);

    // 新增開銷行
    addExpenseBtn.addEventListener('click', () => {
        expenseCounter++;
        const newExpenseRow = document.createElement('div');
        newExpenseRow.className = 'expense-row row mb-3';
        newExpenseRow.innerHTML = `
            <div class="col-12 col-md-6">
                <label for="expenseName${expenseCounter}">開銷名稱:</label>
                <input type="text" id="expenseName${expenseCounter}" class="form-control expense-name" placeholder="例如：房租、伙食費">
            </div>
            <div class="col-12 col-md-6">
                <label for="expenseRange${expenseCounter}">開銷金額(萬):</label>
                <div class="range-container">
                    <input type="range" id="expenseRange${expenseCounter}" class="form-range expense-range" 
                           min="0" max="${monthlyIncomeRange.value}" step="0.1" value="1">
                    <span id="expenseValue${expenseCounter}" class="expense-amount-value value-text">1</span>
                    <span class="value-text">萬</span>
                </div>
            </div>
        `;
        expensesContainer.appendChild(newExpenseRow);

        // 為新增的開銷範圍設置監聽器
        const newExpenseRange = document.getElementById(`expenseRange${expenseCounter}`);
        setupExpenseRangeListeners(newExpenseRange);
    });

    // 計算預算
    calculateBudgetBtn.addEventListener('click', () => {
        // 獲取年月選擇值
        const yearSelect = document.getElementById('yearSelect');
        const monthSelect = document.getElementById('monthSelect');
        
        // 獲取收入和開銷數據
        const totalIncome = parseFloat(monthlyIncomeRange.value);
        const expenseNames = document.querySelectorAll('.expense-name');
        const expenseRanges = document.querySelectorAll('.expense-range');
        
        let totalExpenses = 0;
        const expenseDetails = [];

        // 計算總開銷並準備明細
        expenseNames.forEach((nameInput, index) => {
            const amount = parseFloat(expenseRanges[index].value);
            totalExpenses += amount;
            
            if (nameInput.value.trim() !== '') {
                expenseDetails.push({
                    name: nameInput.value,
                    amount: amount
                });
            }
        });

        // 更新結果顯示
        document.getElementById('budgetPeriodDisplay').textContent = 
            `${yearSelect.value}年${monthSelect.value}月`;
        document.getElementById('totalIncomeDisplay').textContent = `${totalIncome} 萬`;
        document.getElementById('totalExpensesDisplay').textContent = `${totalExpenses.toFixed(1)} 萬`;
        document.getElementById('remainingAmountDisplay').textContent = 
            `${(totalIncome - totalExpenses).toFixed(1)} 萬`;

        // 填充開銷明細表格
        const expenseDetailsBody = document.getElementById('expenseDetailsBody');
        expenseDetailsBody.innerHTML = expenseDetails.map(expense => 
            `<tr><td>${expense.name}</td><td>${expense.amount} 萬</td></tr>`
        ).join('');

        // 顯示結果區域
        resultArea.classList.remove('d-none');
    });

    // PDF匯出功能（待實現）
    document.getElementById('exportPdfBtn').addEventListener('click', () => {
        alert('PDF匯出功能尚未實作');
    });
});
</script>

<!-- 引入Bootstrap JS框架 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
